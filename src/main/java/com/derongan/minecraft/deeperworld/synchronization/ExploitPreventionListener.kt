package com.derongan.minecraft.deeperworld.synchronization

import com.derongan.minecraft.deeperworld.world.section.correspondingSection
import org.bukkit.entity.EntityType
import org.bukkit.event.EventHandler
import org.bukkit.event.Listener
import org.bukkit.event.block.BlockPistonExtendEvent
import org.bukkit.event.block.BlockPistonRetractEvent
import org.bukkit.event.entity.EntitySpawnEvent

object ExploitPreventionListener : Listener {
    /** Disables pistons extending if they are in the overlap of two sections */
    @EventHandler
    fun onPistonExtendEvent(event: BlockPistonExtendEvent) {
        //TODO handle pistons properly instead of just cancelling the event
        if (event.blocks.any { it.location.correspondingSection != null })
            event.isCancelled = true
    }

    /** Disables pistons retracting if they are in the overlap of two sections */
    @EventHandler
    fun onPistonRetractEvent(event: BlockPistonRetractEvent) {
        if (event.blocks.any { it.location.correspondingSection != null })
            event.isCancelled = true
    }

    /** Disables Iron Golem and Wither summons in section transitions due to duping **/
    @EventHandler
    fun onEntitySummon(event: EntitySpawnEvent) {
        if (event.entity.location.correspondingSection != null)
            if (event.entityType == EntityType.WITHER || event.entityType == EntityType.IRON_GOLEM) {
                event.isCancelled = true
            }
    }
}